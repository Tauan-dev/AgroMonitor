<!-- ===== LANDING PAGE ===== -->
<div *ngIf="!showAnalysis" class="landing-page" [@slideIn]>
  <!-- Header da Landing -->
  <header class="landing-header">
    <div class="landing-nav">
      <div class="landing-logo">
        <span class="logo-agro">AGRO</span
        ><span class="logo-milho">MONITOR</span>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="landing-hero">
    <div class="hero-container">
      <!-- Lado Esquerdo: Conte√∫do -->
      <div class="hero-left" [@fadeIn]>
        <h1 class="hero-title">
          <span class="hero-agro">AGROMONITOR</span>
        </h1>

        <p class="hero-subtitle">Dashboard de An√°lise</p>

        <p class="hero-description">
          An√°lise dos fornecedores de insumos para plantio
        </p>

        <!-- Bot√£o CTA -->
        <button class="btn-cta" (click)="startAnalysis()">
          <span class="btn-cta-text">INICIAR AN√ÅLISE</span>
          <span class="btn-cta-arrow">‚Üí</span>
        </button>

        <!-- Social Icons -->
        <div class="hero-footer">
          <div class="footer-social">
            <a
              href="https://github.com/Tauan-dev/AgroMonitor"
              class="footer-link"
              title="Site"
            >
              <img
                src="https://cdn.discordapp.com/attachments/1125892268138713201/1444796391686934638/icons8-github-64.png?ex=692e02fe&is=692cb17e&hm=c43d8965991d1cc51ee4d45e61c190cec240dd7a5e9b019e3f83d1ee35f1d71a&"
                alt="Site"
                class="footer-icon"
              />
            </a>
            <a
              href="https://www.linkedin.com/in/tauan-neres-silva-585b02199/"
              class="footer-link"
              title="LinkedIn"
            >
              <img
                src="https://cdn.discordapp.com/attachments/1125892268138713201/1444796364272828549/icons8-linkedin-48.png?ex=692e02f8&is=692cb178&hm=7d1ccd6f482d06a89f0580e4857562c1775cad5591ae5bd6906c9ce46d5808f3&"
                alt="LinkedIn"
                class="footer-icon"
              />
            </a>
          </div>
        </div>
      </div>

      <!-- Lado Direito: Imagens -->
      <div class="hero-right" [@fadeIn]>
        <div class="image-grid">
          <div class="image-card image-card-1">
            <img
              src="https://cdn.discordapp.com/attachments/1125892268138713201/1444794364936323213/campo.jpg?ex=692e011b&is=692caf9b&hm=d1c87c438b54abebf8be41825b6a6f21deba0fe5381c9447d7968c1de086ec02&"
              alt="Muda"
            />
          </div>
          <div class="image-card image-card-2">
            <img
              src="https://images.unsplash.com/photo-1574943320219-553eb213f72d?w=400&h=300&fit=crop"
              alt="Planta√ß√£o"
            />
          </div>
          <div class="image-card image-card-3">
            <img
              src="https://images.unsplash.com/photo-1560493676-04071c5f467b?w=400&h=300&fit=crop"
              alt="Agricultura"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Ondas decorativas (background) -->
    <svg class="waves" viewBox="0 0 1200 120" preserveAspectRatio="none">
      <path
        d="M0,50 Q300,100 600,50 T1200,50 L1200,120 L0,120 Z"
        fill="rgba(76,175,80,0.1)"
      ></path>
      <path
        d="M0,60 Q300,90 600,60 T1200,60 L1200,120 L0,120 Z"
        fill="rgba(46,125,50,0.05)"
        style="animation: wave 15s linear infinite"
      ></path>
    </svg>
  </section>

  <!-- Features Section -->
  <section class="landing-features">
    <div class="features-container">
      <h2 class="features-title">O que o AGROMONITOR faz?</h2>

      <div class="features-grid">
        <!-- Feature 1 -->
        <div class="feature-card" [@fadeIn]>
          <div class="feature-icon">
            <span class="material-symbols-outlined"> bar_chart </span>
          </div>
          <h3 class="feature-name">An√°lise Num√©rica</h3>
          <p class="feature-desc">
            Aplica m√©todos avan√ßados de √°lgebra linear para an√°lise de
            sensibilidade em planejamento agr√≠cola
          </p>
        </div>

        <!-- Feature 2 -->
        <div class="feature-card" [@fadeIn]>
          <div class="feature-icon">
            <span class="material-symbols-outlined"> document_search </span>
          </div>
          <h3 class="feature-name">Estabilidade Robusta</h3>
          <p class="feature-desc">
            Calcula o n√∫mero de condi√ß√£o (Œ∫) para avaliar a estabilidade
            num√©rica do sistema de recursos
          </p>
        </div>

        <!-- Feature 3 -->
        <div class="feature-card" [@fadeIn]>
          <div class="feature-icon">
            <span class="material-symbols-outlined"> finance_mode </span>
          </div>
          <h3 class="feature-name">Cen√°rios Din√¢micos</h3>
          <p class="feature-desc">
            Simula cen√°rios pessimistas e otimistas com perturba√ß√µes ajust√°veis
            de recursos
          </p>
        </div>

        <!-- Feature 4 -->
        <div class="feature-card" [@fadeIn]>
          <div class="feature-icon">
            <span class="material-symbols-outlined"> agriculture </span>
          </div>
          <h3 class="feature-name">A√ß√µes Estrat√©gicas</h3>
          <p class="feature-desc">
            Gera interpreta√ß√µes autom√°ticas e recomenda√ß√µes estrat√©gicas
            baseadas em dados
          </p>
        </div>

        <!-- Feature 5 -->
        <div class="feature-card" [@fadeIn]>
          <div class="feature-icon">
            <span class="material-symbols-outlined"> attach_money </span>
          </div>
          <h3 class="feature-name">Otimiza√ß√£o de Lucros</h3>
          <p class="feature-desc">
            Calcula lucros base, pessimistas e otimistas para cada cen√°rio de
            recursos
          </p>
        </div>

        <!-- Feature 6 -->
        <div class="feature-card" [@fadeIn]>
          <div class="feature-icon">
            <span class="material-symbols-outlined"> eco </span>
          </div>
          <h3 class="feature-name">Contexto Agr√≠cola</h3>
          <p class="feature-desc">
            Fornece recomenda√ß√µes pr√°ticas adaptadas ao contexto real de
            produ√ß√£o agr√≠cola
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Call to Action Final -->
  <section class="landing-cta-section">
    <div class="cta-box">
      <h2 class="cta-title">Pronto para otimizar seu planejamento?</h2>
      <p class="cta-subtitle">
        Comece a an√°lise agora e descubra insights sobre a robustez do seu
        sistema de recursos
      </p>
      <button class="btn-cta-large" (click)="startAnalysis()">
        üöÄ INICIAR AN√ÅLISE AGORA
      </button>
    </div>
  </section>

  <!-- Footer -->
<footer class="landing-footer">
  <p>
    &copy; 2025 AGROMONITOR ‚Ä¢ An√°lise Agr√≠cola com Sensibilidade Num√©rica ‚Äî
    <span class="landing-author">feito por Tauan Neres Silva</span>
  </p>
</footer>

</div>

<!-- ===== AN√ÅLISE PAGE ===== -->
<div *ngIf="showAnalysis" class="agromilho-dashboard" [@fadeIn]>
  <!-- Header com bot√£o de voltar -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <button class="btn-back" (click)="backToLanding()" title="Voltar">
          ‚Üê Voltar
        </button>
        <h1 class="header-title">
          <span class="brand-accent">AGRO</span
          ><span class="brand-main">AN√ÅLISE</span>
        </h1>
        <p class="header-subtitle">
          An√°lise de Planejamento Agr√≠cola com Sensibilidade Num√©rica
        </p>
      </div>
      <div class="header-right">
        <div class="status-badge status-ready">
          <span class="status-dot"></span>
          {{ loading ? "Processando..." : "Pronto para An√°lise" }}
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN CONTAINER -->
  <div class="dashboard-container">
    <!-- SE√á√ÉO 1: FILTROS E PAR√ÇMETROS -->
    <section class="params-hero">
      <div class="params-inner">
        <div class="params-left">
          <h2 class="params-title">üéØ Configurar An√°lise</h2>
          <p class="params-description">
            Ajuste a perturba√ß√£o relativa para analisar robustez do planejamento
            agr√≠cola
          </p>
        </div>

        <div class="params-controls">
          <div class="slider-group">
            <label class="slider-label">
              Perturba√ß√£o Relativa
              <span class="slider-value-badge"
                >{{ (input.rel_perturb * 100).toFixed(1) }}%</span
              >
            </label>
            <input
              type="range"
              min="0.01"
              max="0.30"
              step="0.01"
              [value]="input.rel_perturb"
              (change)="updatePerturbation($any($event.target).value)"
              class="slider-input"
            />
            <div class="slider-markers">
              <span>0.1%</span>
              <span>15%</span>
              <span>30%</span>
            </div>
          </div>

          <button
            (click)="analyze()"
            [disabled]="loading"
            class="btn-analyze"
            [class.btn-loading]="loading"
          >
            <span class="btn-icon">{{ loading ? "‚è≥" : "‚ñ∂" }}</span>
            <span class="btn-text">{{
              loading ? "Analisando..." : "Executar An√°lise"
            }}</span>
          </button>
        </div>
      </div>
    </section>

    <!-- ALERTAS DE ERRO -->
    <div *ngIf="error" class="alert-container alert-error-container">
      <div class="alert-content">
        <span class="alert-icon">‚ö†Ô∏è</span>
        <div class="alert-text">
          <strong>Erro na An√°lise</strong>
          <p>{{ error }}</p>
          <p style="font-size: 12px; margin-top: 8px; color: #999">
            üí° Verifique se o backend est√° rodando em http://localhost:8000
          </p>
        </div>
        <button class="alert-close" (click)="error = null">‚úï</button>
      </div>
    </div>

    <!-- DEBUG: Dados carregados com sucesso -->
    <div
      *ngIf="hasResult"
      style="
        background: #e8f5e9;
        padding: 12px;
        border-radius: 8px;
        margin: 16px 0;
        border-left: 4px solid #4caf50;
      "
    >
      <p style="margin: 0; color: #2e7d32; font-weight: 600">
        ‚úÖ Dados carregados com sucesso!
      </p>
    </div>

    <!-- RESULTADOS DIN√ÇMICOS -->
    <ng-container *ngIf="result as r">
      <!-- KPI CARDS -->
      <section class="kpi-section">
        <h2 class="section-title">üí∞ Cen√°rios de Lucro</h2>

        <div class="kpi-grid kpi-three-column">
          <!-- CARD 1: BASE -->
          <div class="kpi-card kpi-base" [@fadeIn]>
            <div class="kpi-header">
              <span class="kpi-icon">üìä</span>
              <span class="kpi-badge badge-info">Base</span>
            </div>
            <div class="kpi-value">
              R$
              {{
                r.profit_base !== undefined && r.profit_base !== null
                  ? r.profit_base.toLocaleString("pt-BR", {
                      maximumFractionDigits: 0
                    })
                  : "‚Äî"
              }}
            </div>
            <div class="kpi-label">Cen√°rio Atual com Recursos Existentes</div>
            <div class="kpi-footer">
              <span class="kpi-meta">Refer√™ncia de an√°lise</span>
            </div>
          </div>

          <!-- CARD 2: PESSIMISTA -->
          <div class="kpi-card kpi-pessimistic" [@fadeIn]>
            <div class="kpi-header">
              <span class="kpi-icon">‚ö†Ô∏è</span>
              <span class="kpi-badge badge-danger">Risco</span>
            </div>
            <div class="kpi-value">
              R$
              {{
                r.profit_pert_pessimistic !== undefined &&
                r.profit_pert_pessimistic !== null
                  ? r.profit_pert_pessimistic.toLocaleString("pt-BR", {
                      maximumFractionDigits: 0
                    })
                  : "‚Äî"
              }}
            </div>
            <div class="kpi-label">
              Recursos Reduzidos em
              {{ (input.rel_perturb * 100).toFixed(1) }}%
            </div>
            <div class="kpi-footer" *ngIf="r.profit_base">
              <span class="kpi-change negative">
                {{
                  (
                    ((r.profit_pert_pessimistic - r.profit_base) /
                      r.profit_base) *
                    100
                  ).toFixed(1)
                }}%
              </span>
              <span class="kpi-meta">impacto negativo</span>
            </div>
          </div>

          <!-- CARD 3: OTIMISTA -->
          <div class="kpi-card kpi-optimistic" [@fadeIn]>
            <div class="kpi-header">
              <span class="kpi-icon">‚úÖ</span>
              <span class="kpi-badge badge-success">Oportunidade</span>
            </div>
            <div class="kpi-value">
              R$
              {{
                r.profit_pert_optimistic !== undefined &&
                r.profit_pert_optimistic !== null
                  ? r.profit_pert_optimistic.toLocaleString("pt-BR", {
                      maximumFractionDigits: 0
                    })
                  : "‚Äî"
              }}
            </div>
            <div class="kpi-label">
              Recursos Aumentados em
              {{ (input.rel_perturb * 100).toFixed(1) }}%
            </div>
            <div class="kpi-footer" *ngIf="r.profit_base">
              <span class="kpi-change positive">
                {{
                  (
                    ((r.profit_pert_optimistic - r.profit_base) /
                      r.profit_base) *
                    100
                  ).toFixed(1)
                }}%
              </span>
              <span class="kpi-meta">ganho potencial</span>
            </div>
          </div>
        </div>
      </section>

      <!-- AN√ÅLISE T√âCNICA -->
      <section class="metrics-section">
        <h2 class="section-title">üî¨ An√°lise T√©cnica</h2>

        <div class="metrics-grid metrics-two-column">
          <!-- CARD: CONDICIONAMENTO -->
          <div class="metric-card metric-condition" [@fadeIn]>
            <div class="metric-header">
              <h3 class="metric-title">N√∫mero de Condi√ß√£o (Œ∫)</h3>
              <div
                class="condition-badge"
                [class]="
                  r.kappa < 1e2
                    ? 'well-conditioned'
                    : r.kappa < 1e4
                    ? 'moderately-conditioned'
                    : 'ill-conditioned'
                "
              >
                {{
                  r.kappa < 1e2
                    ? "‚úì Bem Condicionado"
                    : r.kappa < 1e4
                    ? "‚ö† Moderado"
                    : "üî¥ Mal Condicionado"
                }}
              </div>
            </div>

            <div class="metric-value-large">
              {{
                r.kappa !== undefined && r.kappa !== null
                  ? r.kappa.toExponential(2)
                  : "‚Äî"
              }}
            </div>

            <div class="metric-explanation">
              <div class="explanation-item">
                <strong class="exp-title">O que √©?</strong>
                <p class="exp-text">
                  Mede a estabilidade num√©rica do sistema. Valores baixos =
                  sistema robusto; valores altos = sistema fr√°gil.
                </p>
              </div>

              <div class="explanation-item">
                <strong class="exp-title">Interpreta√ß√£o:</strong>
                <p class="exp-text">
                  <span
                    *ngIf="r.kappa < 1e2"
                    class="exp-highlight well-highlight"
                  >
                    ‚úì Pequenos erros em recursos causam pequenos erros nas
                    solu√ß√µes. Sistema muito est√°vel.
                  </span>
                  <span
                    *ngIf="r.kappa >= 1e2 && r.kappa < 1e4"
                    class="exp-highlight moderate-highlight"
                  >
                    ‚ö† Erros moderados podem ser amplificados na solu√ß√£o.
                    Monitoramento recomendado.
                  </span>
                  <span
                    *ngIf="r.kappa >= 1e4"
                    class="exp-highlight ill-highlight"
                  >
                    üî¥ Erros pequenos podem resultar em mudan√ßas grandes e
                    imprediz√≠veis. Alto risco num√©rico.
                  </span>
                </p>
              </div>
            </div>
          </div>

          <!-- CARD: SENSIBILIDADE -->
          <div class="metric-card metric-sensitivity" [@fadeIn]>
            <div class="metric-header">
              <h3 class="metric-title">
                Sensibilidade Relativa (||Œîx||/||x||)
              </h3>
              <div class="sensitivity-rate">
                1% recursos ‚Üí
                <strong
                  >{{
                    r.rel_dx !== undefined && r.rel_dx !== null
                      ? (r.rel_dx * 100).toFixed(2)
                      : "‚Äî"
                  }}%</strong
                >
                √°reas
              </div>
            </div>

            <div class="metric-value-large metric-value-teal">
              {{
                r.rel_dx !== undefined && r.rel_dx !== null
                  ? r.rel_dx.toExponential(2)
                  : "‚Äî"
              }}
            </div>

            <div class="metric-explanation">
              <div class="explanation-item">
                <strong class="exp-title">O que √©?</strong>
                <p class="exp-text">
                  Mede quanto as √°reas plantadas mudam quando os recursos variam
                  1%. Indicador de resili√™ncia do plano.
                </p>
              </div>

              <div class="explanation-item">
                <strong class="exp-title">Interpreta√ß√£o:</strong>
                <p class="exp-text">
                  <span
                    *ngIf="r.rel_dx < 0.5"
                    class="exp-highlight well-highlight"
                  >
                    ‚úì Plano √© resiliente; mudan√ßas pequenas em insumos afetam
                    pouco o plano.
                  </span>
                  <span
                    *ngIf="r.rel_dx >= 0.5 && r.rel_dx < 2"
                    class="exp-highlight moderate-highlight"
                  >
                    ‚ö† Plano tem sensibilidade moderada; mudan√ßas em insumos
                    exigem ajustes estrat√©gicos.
                  </span>
                  <span
                    *ngIf="r.rel_dx >= 2"
                    class="exp-highlight ill-highlight"
                  >
                    üî¥ Plano √© sens√≠vel; varia√ß√µes pequenas em recursos requerem
                    replaneamento frequente.
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- VISUALIZA√á√ïES -->
      <section class="charts-section">
        <h2 class="section-title">üìä An√°lise Visual & Gr√°ficos</h2>

        <div class="charts-grid charts-four-column">
          <div class="chart-card" [@fadeIn]>
            <div class="chart-header">
              <h3 class="chart-title">Mapa de Sensibilidade</h3>
              <span class="chart-meta">Recurso √ó Cultura</span>
            </div>
            <div class="chart-body">
              <img
                *ngIf="r.heatmap"
                [src]="'data:image/png;base64,' + r.heatmap"
                alt="Heatmap de Sensibilidade"
                loading="lazy"
              />
              <p *ngIf="!r.heatmap" style="color: #999">
                Gr√°fico n√£o dispon√≠vel
              </p>
            </div>
          </div>

          <div class="chart-card" [@fadeIn]>
            <div class="chart-header">
              <h3 class="chart-title">Cen√°rios de Produ√ß√£o</h3>
              <span class="chart-meta">Base vs Perturbado</span>
            </div>
            <div class="chart-body">
              <img
                *ngIf="r.comparison"
                [src]="'data:image/png;base64,' + r.comparison"
                alt="Compara√ß√£o Base vs Perturbado"
                loading="lazy"
              />
              <p *ngIf="!r.comparison" style="color: #999">
                Gr√°fico n√£o dispon√≠vel
              </p>
            </div>
          </div>

          <div class="chart-card" [@fadeIn]>
            <div class="chart-header">
              <h3 class="chart-title">Estabilidade Num√©rica</h3>
              <span class="chart-meta">Bem vs Mal Condicionado</span>
            </div>
            <div class="chart-body">
              <img
                *ngIf="r.sensitivity"
                [src]="'data:image/png;base64,' + r.sensitivity"
                alt="Sensibilidade Bem vs Mal Condicionado"
                loading="lazy"
              />
              <p *ngIf="!r.sensitivity" style="color: #999">
                Gr√°fico n√£o dispon√≠vel
              </p>
            </div>
          </div>

          <div class="chart-card" [@fadeIn]>
            <div class="chart-header">
              <h3 class="chart-title">Regulariza√ß√£o</h3>
              <span class="chart-meta">Normal vs Otimizada</span>
            </div>
            <div class="chart-body">
              <img
                *ngIf="r.regularization"
                [src]="'data:image/png;base64,' + r.regularization"
                alt="Normal vs Regularizado"
                loading="lazy"
              />
              <p *ngIf="!r.regularization" style="color: #999">
                Gr√°fico n√£o dispon√≠vel
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- INSIGHTS COM IA -->
      <ng-container *ngIf="interpretedResult as interp">
        <section class="insights-section">
          <h2 class="section-title">A√ß√µes Estrat√©gicas</h2>

          <div class="insight-card insight-summary-card" [@fadeIn]>
            <div class="insight-header">
              <span class="insight-icon">üìù</span>
              <h3 class="insight-title">Resumo Executivo</h3>
            </div>
            <p class="insight-text">{{ interp.summary }}</p>
            <div class="insight-footer">
              <span class="insight-confidence">Alta Confian√ßa</span>
            </div>
          </div>

          <div class="insight-card insight-technical-card" [@fadeIn]>
            <div class="insight-header">
              <span class="insight-icon">üî¨</span>
              <h3 class="insight-title">An√°lise T√©cnica Detalhada</h3>
            </div>
            <div
              class="insight-text html-content"
              [innerHTML]="interp.dataScienceInsight | safe"
            ></div>
          </div>

          <div class="insight-card insight-agriculture-card" [@fadeIn]>
            <div class="insight-header">
              <span class="insight-icon">üåæ</span>
              <h3 class="insight-title">Recomenda√ß√µes Agr√≠colas</h3>
            </div>
            <p class="insight-text">{{ interp.agriculturalContext }}</p>
          </div>

          <div class="insight-card insight-predictive-card" [@fadeIn]>
            <div class="insight-header">
              <span class="insight-icon">üîÆ</span>
              <h3 class="insight-title">Diagn√≥stico Preditivo</h3>
            </div>
            <div
              class="insight-text html-content"
              [innerHTML]="interp.predictiveDiagnosis | safe"
            ></div>
          </div>

          <div class="insight-card insight-recommendations-card" [@fadeIn]>
            <div class="insight-header">
              <span class="insight-icon">‚úÖ</span>
              <h3 class="insight-title">Recomenda√ß√µes Estrat√©gicas</h3>
            </div>
            <ul class="recommendations-list">
              <li
                *ngFor="let rec of interp.recommendations"
                class="recommendation-item"
              >
                <span class="rec-check">‚úì</span>
                <span class="rec-text">{{ rec }}</span>
              </li>
            </ul>
          </div>

          <div
            *ngIf="interp.riskFlags && interp.riskFlags.length > 0"
            class="insight-card insight-risks-card"
            [@fadeIn]
          >
            <div class="insight-header">
              <span class="insight-icon">‚ö†Ô∏è</span>
              <h3 class="insight-title">Alertas de Risco</h3>
            </div>
            <div class="risk-flags-container">
              <div
                *ngFor="let flag of interp.riskFlags"
                [class]="'risk-flag risk-flag-' + flag.level"
              >
                <span class="risk-icon">
                  {{
                    flag.level === "critical"
                      ? "üî¥"
                      : flag.level === "warning"
                      ? "‚ö†Ô∏è"
                      : "‚ÑπÔ∏è"
                  }}
                </span>
                <div class="risk-content">
                  <span class="risk-label">{{ flag.level | uppercase }}</span>
                  <span class="risk-message">{{ flag.message }}</span>
                </div>
              </div>
            </div>
          </div>
        </section>
      </ng-container>
    </ng-container>
  </div>
</div>
